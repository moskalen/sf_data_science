# Проект 4. Разработать рекомендательную систему для интернет-магазина, чтобы увеличить прибыль от допродаж на 20 %

## Оглавление
[1. Описание проекта](README.md#Описание-проекта)

[2. Инструкция для проверки проекта](README.md#Инструкция-для-проверки-проекта)

[3. Краткая информация о данных](README.md#Краткая-информация-о-данных)

[4. Этапы работы над проектом](README.md#Этапы-работы-над-проектом)

[5. Проведенные эксперименты](README.md#Проведенные-эксперименты)

[6. Результаты](README.md#Результаты)

### Описание проекта
Клиент — крупная компания-ритейлер. Рекомендации товаров должны отображаться на главной странице сайта, чтобы пользователь сразу видел их при заходе на сайт. Система должна предлагать три товара для каждой рекомендации.

:arrow_up:[ к оглавлению](README.md#Оглавление)


### Инструкция для проверки проекта

1. Скопируйте проект `final2/`
    > Можно клонировать весь репозиторий:
    ```
    git clone git@github.com:moskalen/sf_data_science.git
    cd sf_data_science/final2
    ```

2. Загрузите [архив с данными](https://drive.google.com/file/d/1dMXVdxNYQfWaWc-oIfbPdTaF3qS2IJ4V/view?usp=drive_link) и раскройте его в папку `final2/data/`.

    Дожен получится следующий список:

    * лог событий - `data/events.csv.zip`
    * дерево категорий - `data/category_tree.csv.zip`
    * свойства товаров-1 - `data/item_properties_part1.csv.zip`
    * свойства товаров-2 - `data/item_properties_part2.csv.zip`

3. Загрузите в папку `final2/models/` следующие файлы:

    * [Модель LightFM c информацией о пользователях и товарах](https://drive.google.com/file/d/1iro8kpCmWRJDNcO4djxps9N_OQhuD-SG/view?usp=sharing)
    * [Матрица взаимодействий](https://drive.google.com/file/d/1JRFJkTe8Zxbs6TsBMx4sZJq8iVn7L_o-/view?usp=sharing)

4. Загрузите [`requirements.txt`](requirements.txt)

    ```
    pip install -r requirements.txt
    ```

5. По очереди запустите на выполнение:
    * [week1_2.ipynb](week1_2.ipynb)
        > После выполения в папке `data/` появятся файлы:

            * `item_features.csv` - факторы связанные с айтемами

            * `user_item_features.csv` - айтем-юзер факторы

            * `events_train.csv` - тренировочная выборка

            * `events_test.csv` - тестовоя выборка

    * для обучения модели (этот шаг не нужен, если модель была уже загружена):

        * обучения модели:
        [train_lightfm_model.py](train_lightfm_model.py)

        * создания матрицы взаимодействий:
        [prepare.py](prepare.py)

    * [для запуска приложения](docker.md)


### Краткая информация о данных

`events` — датасет с событиями. Колонки:

* timestamp — время события
* visitorid — идентификатор пользователя
* event — тип события
* itemid — идентификатор объекта
* transactionid — идентификатор транзакции, если она проходила

`category_tree` — файл с деревом категорий (можно восстановить дерево).

* category_id — идентификатор категорий
* parent_id — идентификатор родительской категории

`item_properties` — файл с свойствами товаров.

* timestamp — момент записи значения свойства
* item_id — идентификатор объекта
* property — свойство, кажется, они все, кроме категории, захешированы
* value — значение свойства

:arrow_up:[ к оглавлению](README.md#Оглавление)

### Этапы работы над проектом

| Таск                         | Подзадача                                | Неделя |
|------------------------------|------------------------------------------|--------|
| Постановка задачи            | Уточнение бизнес-постановки задачи       | 1      |
|                              | Выбор технических метрик качества        | 1      |
|                              | Получение данных                         | 1      |
| Исследование данных          | Описание структуры данных                | 1      |
|                              | Статистический анализ данных             | 1      |
| Создание факторов для модели | Генерация факторов, связанных с айтемами | 2      |
|                              | Генерация факторов айтем-юзер            | 2      |
| Проведение экспериментов     | Коллаборативная фильтрация               | 3      |
|                              | Факторизационные машины                  | 3      |
| Создание MVP                 | Проектирование API сервиса               | 4      |
|                              | Создание веб-сервиса с моделью           | 4      |
| Контейнеризация              | Создание Docker-контейнера с сервисом    | 4      |


:arrow_up:[ к оглавлению](README.md#Оглавление)

### Проведенные эксперименты

Были сделаны следующие шаги для каждой модели (на примере `LightFM`):
* [обучение на тренировочной выборке](train_lightfm_model.py):
    ```bash
    python train_lightfm_model.py
    ```
* [предсказание на тестовой выборке](predict_and_recommend_lightfm.py):
    ```bash
    python predict_and_recommend_lightfm.py
    ```
* [оценка Precision\@3](evaluate_lightfm_precision_at_3.py):
    ```bash
    python evaluate_lightfm_precision_at_3.py
    ```

| Модель                  | Precision\@3 (по покупателям) | Precision\@3 (глобальная) |
| ----------------------- | ----------------------------- | ------------------------- |
| **Random Forest**       | **0.4050**                    | 0.0019                    |
| **CatBoost**            | **0.4128**                    | 0.0007                    |
| **LightGBM**            | 0.4058                        | 0.0019                    |
| **LightFM**             | 0.2727                        | **0.3368**                |
| **KNN (на признаках)**  | 0.2777                        | 0.0010                    |
| **KNN (Collaborative)** | 0.0028                        | 0.0000                    |

Была выбрана модель `LightFM`, поскольку она лучше всего справляется с рекомендациями в общем, даже если пользователь не покупал ранее.


:arrow_up:[ к оглавлению](README.md#Оглавление)

### Результаты:

* [Выбранная модель](recommendation_model_report.md)

* [Презентация модели](final_lightfm_presentation.md)

* [Создание Docker-контейнера с сервисом](docker.md)

:arrow_up:[ к оглавлению](README.md#Оглавление)
